<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>



  <title>Part 1</title>
  <style>
    body {
      background-color: #fbdfc7;
      color: #333333;
      font-family: "Prompt", sans-serif;
      padding: 40px;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;


    }

    @media (max-width: 576px) {
      .quote {
        font-size: 0.8rem;
        line-height: 1.8;
        padding: 0 10px;
      }
    }

    img {
      max-width: 100%;
      height: auto;
    }

    h3,
    h4 {
      line-height: 1.6;
    }

    h4 {
      color: #373737;
    }


    @media (max-width: 576px) {
      h2 {
        font-size: 1.5rem;
      }

      h3 {
        font-size: 1.3rem;
      }

      h4 {
        font-size: 1.2rem;
      }

      .quote {
        font-size: 1.2rem;
      }

      .arrow-text {
        padding: 1rem 2rem;
        font-size: 1.2rem;
      }
    }

    .arrow-text {
      display: inline-block;
      padding: 1.5rem 3rem;
      font-size: 1.5rem;
      color: #7c7c7c60;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.2s, transform 0.2s;
      border-radius: 0.5rem;
      user-select: none;
      cursor: pointer;
    }

    .arrow-text:hover {
      color: #555555a5;
      transform: scale(1.1);
    }

    #section-1,
    #section0,
    #section1,
    #section2,
    #section3,
    #section4,
    #section5,
    #section6,
    #section7,
    #section8,
    #section9 {
      display: none !important;
      margin-top: 1.5rem;
    }

    #section-1.active,
    #section0.active,
    #section1.active,
    #section2.active,
    #section3.active,
    #section4.active,
    #section5.active,
    #section6.active,
    #section7.active,
    #section8.active,
    #section9.active {
      display: block !important;
    }

    .submit-btn {
      background-color: #333;
      color: white;
      border: 2px solid #333;
      font-weight: 600;
      font-size: 1.2rem;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .submit-btn:hover {
      background-color: rgb(125, 124, 124);
      color: #333;
      border-color: #333;
      cursor: pointer;
    }

    .submit-btn:active {
      background-color: #555;
      color: white;
      border-color: #555;
      transform: scale(0.98);
    }

    #section3 form {
      max-width: 400px;
      margin: 0 auto;
      border-radius: 12px;
      user-select: text;
      cursor: auto;
      padding: 0 0.5rem;
    }

    #section3 form label {
      font-weight: 600;
      color: #000000;
    }

    #section3 form input,
    #section3 form select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 2px solid #000000;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      font-family: "Prompt", sans-serif;
    }

    .quote {
      line-height: 1.3;
      text-align: center;
      max-width: 700px;
      margin: auto;
      color: #000000;

    }

    .m {
      margin-top: 110px;
    }

    .m2 {
      margin-top: 300px;
    }

    .m3 {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
    }

    .logo-top {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
    }


    @keyframes bounce1 {

      0%,
      100% {
        transform: translateY(-50%);
      }

      50% {
        transform: translateY(calc(-50% - 15px));
      }
    }

    @keyframes bounce2 {

      0%,
      100% {
        transform: translateY(-50%);
      }

      50% {
        transform: translateY(calc(-50% - 20px));
      }
    }

    @keyframes bounce3 {

      0%,
      100% {
        transform: translateY(-50%);
      }

      50% {
        transform: translateY(calc(-50% - 10px));
      }
    }




    .bg3 {
      background-image: url('/public/img/8.png'), url('/public/img/9.png');
      background-size: 8rem, 10rem;
      background-repeat: no-repeat, no-repeat;
      background-position: right 10% top 60%, left 5% top 85%;
      width: 95vw;
      height: 95vh;
      margin: 0;
      padding: 25px;
    }

    .bg6 {
      background-image: url('/public/img/part1/4.png');
      background-size: clamp(50px, 80vw, 500px);
      background-repeat: no-repeat;
      background-position: right 60% top 80%;
      width: 95vw;
      height: 95vh;
      margin: 0;
      padding: 25px;
    }

    .bg5 {
      background-image: url('/public/img/part1/1.png'), url('/public/img/part1/2.png'), url('/public/img/part1/3.png');
      background-size: clamp(100px, 30vw, 300px), clamp(50px, 30vw, 250px), clamp(50px, 30vw, 250px);
      background-repeat: no-repeat, no-repeat, no-repeat;
      background-position: left 10% top 80%, right 30% top 75%, right 5% top 90%;
      width: 95vw;
      height: 95vh;
      margin: 0;
      padding: 25px;
    }

    .bg7 {
      background-image: url('/public/img/part1/5.png'), url('/public/img/part1/6.png'), url('/public/img/part1/7.png'), url('/public/img/part1/8.png');
      background-size: clamp(10px, 30vw, 200px), clamp(50px, 40vw, 300px), clamp(50px, 40vw, 250px), clamp(30px, 40vw, 250px);
      background-repeat: no-repeat, no-repeat, no-repeat, no-repeat;
      background-position: right 0% top 85%, left 0% top 90%, left 0% top 50%, right 5% top 55%;
      width: 95vw;
      height: 95vh;
      margin: 0;
      padding: 0;
    }

    @media (max-width: 768px) {
      .bg7 {
        background-position: right 0% top 90%, left 0% top 95%, left 0% top 65%, right 5% top 70%;
      }
    }


    #display {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .floating {
      position: absolute;
      font-size: 50px;
      animation: floatUp 3s linear forwards;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0);
        opacity: 1;
      }

      100% {
        transform: translateY(-300px);
        opacity: 0;
      }
    }

    .ma {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
    }

    .ma5 {
      position: absolute;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }


    #section-1 {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      height: 100vh;
      padding: 60px;
      box-sizing: border-box;
      position: relative;
    }

    .boxed {
      border: 2px solid #6b4f3f;
      border-radius: 10px;
      padding: 15px;
      background-color: #fff6ec23;
      display: inline-block;
    }


    #display-part3 .floating {
      position: absolute;
      font-size: 50px;
      animation: floatUp 3s linear forwards;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0);
        opacity: 1;
      }

      100% {
        transform: translateY(-300px);
        opacity: 0;
      }
    }

    #inputBox-part3 {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      background: #ffe9c4;
      padding: 15px 20px;
      border-radius: 25px;
      border: 1px solid rgba(0, 0, 0, 0.266);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #message-part3 {
      width: 250px;
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      outline: none;
      background: #fef7e4c8;
    }

    #sendBtn-part3 {
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      background: #ffa813bb;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #sendBtn-part3:hover {
      background: #dd8a0c;
    }

    #stickers-part3 {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    #stickers-part3 .sticker {
      font-size: 35px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    #stickers-part3 .sticker:hover {
      transform: scale(1.2);
    }

    #inputBox {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      background: #ffe9c4;
      padding: 15px 20px;
      border-radius: 25px;
      border: 1px solid rgba(0, 0, 0, 0.266);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #message {
      width: 250px;
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      outline: none;
      background: #fef7e4c8;
    }

    #sendBtn {
      padding: 10px 15px;
      border: none;
      border-radius: 20px;
      background: #ffa813bb;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #sendBtn:hover {
      background: #dd8a0c;
    }


    #stickers {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .sticker {
      font-size: 35px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .sticker:hover {
      transform: scale(1.2);
    }

    .floating-static {
      position: absolute;
      font-size: 1.5rem;
      color: #333;
      background: #e6dccf;
      border-radius: 25px;
      padding: 12px 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }


    .center-expand {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.2);
      font-size: 2rem;
      opacity: 0;
      animation: expandCenter 0.6s ease-out forwards;
    }

    @keyframes expandCenter {
      0% {
        transform: translate(-50%, -50%) scale(0.2);
        opacity: 0;
      }

      100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 1;
      }
    }

    #section-1 {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
    }
  </style>
</head>


<body>
  <audio id="bgMusic" src="/public/img/part1/m2.mp3" loop></audio>

  <!-- ส่วนที่ -1 -->
  <div class="text-center" id="section-1">
    <div id="display"></div>

    <h2 class="mb-4 ">เด็ก ๆ มีเป้าหมายในการใช้ชีวิตอย่างไรเพื่อไม่ให้ตนเองยุ่งเกี่ยวกับบุหรี่ไฟฟ้า</h2>
    <div class="ma5">
      <div id="inputBox">
        <input type="text" id="message" placeholder="พิมพ์ข้อความ...">
        <button id="sendBtn">ส่ง</button>
      </div>
    </div>
    <div class="ma">
      <a href="#" id="nextBtn8" onclick="playText(5)" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>
  </div>


  <!-- ส่วนที่ 0 -->
  <div class="text-center" id="section0">
    <div id="display-part3"></div>
    <h2 class="mb-4">วันนี้รู้สึกอย่างไรบ้าง</h2>
    <div id="inputBox">
      <input type="text" id="message-part3" placeholder="พิมพ์ข้อความหรือ emoji...">
      <button id="sendBtn-part3">ส่ง</button>
    </div>

    <div id="stickers-part3">
      <span class="sticker" data-sticker="😀">😀</span>
      <span class="sticker" data-sticker="🔥">🔥</span>
      <span class="sticker" data-sticker="🎉">🎉</span>
    </div>
    <div class="ma">
      <a href="#" id="nextBtn0" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>
  </div>
  </div>


  <!-- ส่วนที่ 1 -->
  <div class="text-center" id="section1">
    <img src="/public/img/smok.png" class="img-fluid mb-4 logo-top" alt="No Smoke Logo" style="max-height: 120px;" />
    <h2 class="fw-bold">
      SOC <br>(Smoke Out Challenge)<br>ท้าพิชิตชีวิตไร้ควัน
    </h2>
    <h3 class="my-4">
      "บุหรี่ไม่ใช่แค่เรื่องส่วนตัว แต่กระทบต่อสุขภาพและคนรอบข้าง
      ชีวิตสอนให้เราเห็นการป้องกันสำคัญกว่าการแก้ไข"
    </h3>
    <h7 class="m3">
      *เนื้อหาในเว็บนี้เป็นผลงานการออกแบบการสื่อสาร
      ให้ความรู้ผ่านการให้ผู้เล่นมีส่วนร่วมในการตอบคำถาม
    </h7>
    <div class="ma">
      <a href="#" id="nextBtn1" class="arrow-text">&gt;&gt;&gt;</a>
    </div>
  </div>


  <!-- ส่วนที่ 2 -->
  <div class="text-center bg" id="section2">
    <br>
    <h2 class="fw-bold mb-3" style="color: #222222;">
      งานนี้เป็นส่วนหนึ่ง <br>ของงานวิจัย
    </h2>
    <h3 class="mt-3 quote">
      ผลของโปรแกรมส่งเสริมสมรรถนะแห่งตนผ่านเกมต่อทัศนคติและการป้องกันการสูบบุหรี่ไฟฟ้า ในนักเรียนชั้นมัธยมศึกษาตอนต้น
    </h3>
    <br> <br>
    <h6 class="mt-5">
      โดยนักศึกษาพยาบาลชั้นปีที่ 3<br />
      วิทยาลัยพยาบาลบรมราชชนนีแพร่
    </h6>
    <div class="ma">
      <a href="#" id="nextBtn2" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>
  </div>


  <!-- ส่วนที่ 3 -->
  <div id="section3" class="container">
    <h3 class="fw-bold mb-4 text-center" style="color: #222222;">กรุณากรอกข้อมูลของคุณ</h3>
    <form id="profileForm">
      <div class="mb-3">
        <label for="nameInput" class="form-label">ชื่อ</label>
        <input type="text" class="form-control" id="nameInput" placeholder="กรอกชื่อของคุณ" required />
      </div>
      <div class="mb-3">
        <label for="ageInput" class="form-label">อายุ</label>
        <input type="number" class="form-control" id="ageInput" placeholder="กรอกอายุของคุณ" min="1" max="120"
          required />
      </div>
      <div class="mb-3">
        <label for="genderSelect" class="form-label">เพศ</label>
        <select class="form-select" id="genderSelect" required>
          <option value="" selected disabled>เลือกเพศ</option>
          <option value="ชาย">ชาย</option>
          <option value="หญิง">หญิง</option>
          <option value="อื่นๆ">อื่นๆ</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary w-100 submit-btn mt-3">แตะเพื่อไปต่อ</button>
    </form>
  </div>


  <!-- ส่วนที่ 4 -->
  <div class="container text-center" id="section4">
    <h2 class="fw-bold mb-5" style="color: #222222;">
      รู้จักบุหรี่ไฟฟ้าหรือไม่
    </h2>

    <div class="d-flex justify-content-center gap-3 mt-4">
      <button id="btnUnderstand" type="button" class="btn btn-outline-success fw-semibold me-5"
        style="min-width: 140px; border-radius: 8px; padding: 0.75rem 2rem; font-size: 1.25rem;">
        รู้จัก
      </button>
      <button id="btnNotUnderstand" type="button" class="btn btn-outline-danger fw-semibold"
        style="min-width: 140px; border-radius: 8px; padding: 0.75rem 2rem; font-size: 1.25rem;">
        ไม่รู้จัก
      </button>
    </div>
  </div>

  <!-- ส่วนที่ 5 -->
  <div class=" text-center  bg5" id="section5" style="max-width: 700px;">
    <h1 class="fw-bold my-4" style="color: #fd6767db;">
      บุหรี่ไฟฟ้า
    </h1>
    <div class="mb-4 p-3 rounded-3 border border-dark">
      <p class="fs-5 mb-0" id="nicotineText5">
        บุหรี่ไฟฟ้า
        คือผลิตภัณฑ์ยาสูบรูปแบบใหม่ที่ใช้แบตเตอรี่ทำให้เกิดความร้อนเพื่อระเหยน้ำยาในบุหรี่ไฟฟ้าให้เป็นละอองลอยโดยไม่มีการเผาไหม้
        ผู้สูบบุหรี่ไฟฟ้าจะสูดละอองลอยผ่านระบบทางเดินหายใจ ในน้ำยาบุหรี่ไฟฟ้ามีสารเคมีสำคัญหลายชนิด ได้แก่
      </p>
    </div>
    <audio id="voice5" src="/public/img/voice.mp3"></audio>
    <div class="mt-5 ma">
      <a href="#" id="nextBtn3" onclick="playText(6)" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>
  </div>

  <!-- ส่วนที่ 6 -->
  <div class=" text-center bg6" id="section6" style="max-width: 700px;">
    <br>
    <div class="mb-4 p-3 rounded-3 border border-dark">
      <p class="fs-5 mb-0 " id="nicotineText6">
        🚬 นิโคติน เป็นสารเสพติดที่เพิ่มการหลั่งของสารโดปามีนในสมองทําให้
        ผู้สูบบุหรี่ไฟฟ้าเสพติด และมีผลต่อร่างกายในการเพิ่มความดันโลหิตและเพิ่มอัตราการเต้นของหัวใจ
        ทําให้หัวใจทํางานหนักขึ้นเสี่ยงต่อหัวใจวายเฉียบพลัน
      </p>
    </div>
    <audio id="voice6" src="/public/img/voice2.mp3"></audio>
    <div class="mt-5 ma">
      <a href="#" id="nextBtn4" onclick="playText(7)" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>
  </div>


  <!-- ส่วนที่ 7 -->
  <div class=" text-center  bg7" id="section7" style="max-width: 700px;">
    <div class="mb-4 p-3 rounded-3 border border-dark">
      <p class="fs-5 mb-0 " id="nicotineText7">
        🍃 สารปรุงแต่งกลิ่นรสชาติ เพื่อจูงใจให้เยาวชนอยากลอง
        สูบบุหรี่ไฟฟ้า สารปรุงแต่งกลิ่นรสชาติจะทําให้เกิดการระคายเคืองของปอดที่เรียกว่าป๊อปคอร์น ลัง โดย
        เฉพาะกลิ่นอบเชย และเชอรี่จะมีอันตรายมากที่สุด
      </p>
    </div>
    <audio id="voice7" src="/public/img/voice3.mp3"></audio>
    <div class="mt-5 ma ">
      <a href="#" id="nextBtn5" class="arrow-text">แตะเพื่อไปต่อ</a>
    </div>


  </div>
  <!-- ส่วนที่ 8 -->
  <div class="container text-center py-2" id="section8">
    <h2 class="fw-bold mt-5" style="color: #222222;">
      เด็กๆเข้าใจกันไหมคะ ?
    </h2>
    <img src="/public/img/3.png" class="img-fluid mb-3" alt="cat" style="max-height: 600px;" />
    <h6 class="text-danger">*ถ้าไม่เข้าใจไปดูสรุปเนื้อหากันอีกรอบ</h6>
    <div class="d-flex justify-content-center gap-3 mt-4">
      <button id="btnUnderstand2" type="button" class="btn btn-outline-success fw-semibold me-5"
        style="min-width: 140px; border-radius: 8px; padding: 0.75rem 2rem; font-size: 1.25rem;">
        เข้าใจ
      </button>
      <button id="btnNotUnderstand2" type="button" class="btn btn-outline-danger fw-semibold"
        style="min-width: 140px; border-radius: 8px; padding: 0.75rem 2rem; font-size: 1.25rem;">
        ไม่เข้าใจ
      </button>
    </div>
    <div class="mt-5">
      <!-- <a href="#" id="nextBtn8" class="arrow-text">ไปต่อ</a> -->
    </div>
  </div>


  <!-- ส่วยที่9 -->
  <div class="container text-center py-5" id="section9">
    <div class="container text-center py-5"
      style="max-width: 700px; margin-top: 3rem; border: 2px dashed #a67c00; border-radius: 12px; background: #fff8e1;">
      <h2 class="fw-bold mb-4 quote" style="color: #8b6d00; font-size: 2rem;">
        แล้วหลักการปฏิเสธที่มีประสิทธิภาพน้องๆคิดว่าเป็นแบบไหนล่ะ ??
      </h2>
      <h4 class="fw-semibold mt-5" style="color: #b38600;">
        โปรดติดตามกิจกรรมครั้งต่อไปน้าาา <span style="font-size: 1.5rem;">✨</span>
      </h4>
    </div>
  </div>

</body>
<script>

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  document.getElementById('section0').classList.add('active');


  const music = document.getElementById("bgMusic");

  const savedTime = localStorage.getItem("musicTime");
  if (savedTime) {
    music.currentTime = parseFloat(savedTime);
  }


  function startMusicOnce() {
    if (music.paused) {
      music.volume = 0.1;
      music.play().catch(err => console.log("Autoplay blocked:", err));
    }


    setInterval(() => {
      if (!music.paused) {
        localStorage.setItem("musicTime", music.currentTime);
      }
    }, 1000);


    document.removeEventListener("click", startMusicOnce, true);
    document.removeEventListener("touchstart", startMusicOnce, true);
    document.removeEventListener("keydown", startMusicOnce, true);
  }


  document.addEventListener("click", startMusicOnce, { once: true, capture: true });
  document.addEventListener("touchstart", startMusicOnce, { once: true, capture: true });
  document.addEventListener("keydown", startMusicOnce, { once: true, capture: true });


  const voices = document.querySelectorAll("audio[id^='voice']");

  voices.forEach(voice => {
    voice.addEventListener("play", () => {
      music.volume = 0.05;
    });

    voice.addEventListener("ended", () => {
      music.volume = 0.1;
    });

    voice.addEventListener("pause", () => {
      music.volume = 0.1;
    });
  });


  const answerButtons = document.querySelectorAll('#section8 .answer-btn');

  answerButtons.forEach(btn => {
    btn.addEventListener('click', function () {

      answerButtons.forEach(b => b.style.background = '#fff');
      answerButtons.forEach(b => b.style.color = '#333');

      this.style.background = '#dfc4aa';
      this.style.color = '#333';

      const nextId = this.dataset.next;
      if (nextId) {
        document.getElementById('section8').classList.remove('active');
        document.getElementById(nextId).classList.add('active');
      }
    });
  });


  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  const socket = io();

  const messageInput = document.getElementById('message');
  const sendBtn = document.getElementById('sendBtn');
  const section1Display = document.getElementById('display');
  const section1 = document.getElementById('section-1');

  function showFloatingMessage(msg) {
    const el = document.createElement('div');
    el.textContent = msg;
    el.className = 'floating-static';

    const width = section1.offsetWidth || window.innerWidth;
    const height = section1.offsetHeight || window.innerHeight;

    const randomX = Math.random() * (width - 250);
    const randomY = Math.random() * (height - 50);

    el.style.position = 'absolute';
    el.style.left = randomX + 'px';
    el.style.top = randomY + 'px';
    const lightColors = ['#fff3e0', '#e0f7fa', '#f3e5f5', '#e8f5e9', '#fffde7'];
    el.style.background = lightColors[Math.floor(Math.random() * lightColors.length)];
    el.style.color = '#555';
    el.style.border = '1px solid #e0d8c3';
    el.style.fontSize = '1.5rem';
    el.style.fontWeight = '600';
    el.style.padding = '12px 20px';
    el.style.borderRadius = '25px';
    el.style.boxShadow = '0 8px 20px rgba(0,0,0,0.25)';
    el.style.transform = 'scale(0.2) rotate(-15deg)';
    el.style.opacity = '0';
    el.style.textShadow = '1px 2px 6px rgba(0,0,0,0.3)';
    el.style.transition = 'transform 0.5s cubic-bezier(0.34,1.56,0.64,1), opacity 0.4s ease-out';

    section1.appendChild(el);
    requestAnimationFrame(() => {
      el.style.transform = 'scale(1) rotate(0deg)';
      el.style.opacity = '1';
    });
  }

  socket.on('receiveSticker-sec1', (msg) => {
    showFloatingMessage(msg);
  });


  function handleSend() {
    const text = messageInput.value.trim();
    if (!text) return;
    socket.emit('sendSticker-sec1', text);
    messageInput.value = '';
  }

  sendBtn.addEventListener('click', handleSend);
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') handleSend();
  });





  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  const part3Socket = io();
  const part3Display = document.getElementById('display-part3');
  const part3MessageInput = document.getElementById('message-part3');
  const part3SendBtn = document.getElementById('sendBtn-part3');
  const part3Stickers = document.querySelectorAll('#stickers-part3 .sticker');


  function sendStickerPart3(sticker) {
    part3Socket.emit('sendSticker-part3', sticker);
  }

  function sendMessagePart3() {
    const text = part3MessageInput.value.trim();
    if (!text) return;

    part3Socket.emit('sendSticker-part3', text);

    const username = localStorage.getItem("username") || "guest";
    fetch("/save-message", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username,
        question: "วันนี้รู้สึกอย่างไรบ้าง",
        message: text,
        timestamp: new Date()
      })
    }).then(res => res.json())
      .then(data => {
        if (data.success) console.log("บันทึกเรียบร้อย");
        else console.error("บันทึกไม่สำเร็จ");
      })
      .catch(err => console.error(err));

    part3MessageInput.value = '';
  }

  part3SendBtn.addEventListener('click', sendMessagePart3);
  part3MessageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') sendMessagePart3();
  });


  part3Stickers.forEach(sticker => {
    sticker.addEventListener('click', () => {
      sendStickerPart3(sticker.textContent);
    });
  });


  part3Socket.on('receiveSticker-part3', (sticker) => {
    const s = document.createElement('div');
    s.textContent = sticker;
    s.className = 'floating';
    s.style.left = Math.random() * (window.innerWidth - 50) + 'px';
    s.style.top = window.innerHeight + 'px';
    part3Display.appendChild(s);

    setTimeout(() => {
      if (s && s.parentNode) {
        s.remove();
      }
    }, 3000);
  });
  function clearFloatingMessages() {
    const floatingMessages = document.querySelectorAll('#display-part3 .floating, #display .floating');
    floatingMessages.forEach(msg => msg.remove());
  }


  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  function setupNextButton(nextBtnId, currentSectionId, nextSectionId) {
    document.getElementById(nextBtnId).addEventListener('click', function (e) {
      e.preventDefault();
      document.getElementById(currentSectionId).classList.remove('active');
      document.getElementById(nextSectionId).classList.add('active');
    });
  }

  document.addEventListener('DOMContentLoaded', function () {

    setupNextButton('nextBtn1', 'section1', 'section2');
    setupNextButton('nextBtn2', 'section2', 'section3');
    setupNextButton('nextBtn8', 'section-1', 'section5');


  });


  const nextBtn0 = document.getElementById('nextBtn0');

  nextBtn0.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    document.getElementById('section0').classList.remove('active');
    document.getElementById('section1').classList.add('active');
    clearFloatingMessages();
  });


  const form = document.querySelector('#section3 form');
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (form.checkValidity()) {
      document.getElementById('section3').classList.remove('active');
      document.getElementById('section-1').classList.add('active');
    } else {
      form.reportValidity();
    }
  });



  document.getElementById('btnNotUnderstand').addEventListener('click', function (e) {
    e.stopPropagation();
    document.getElementById('section4').classList.remove('active');
    document.getElementById('section-1').classList.add('active');
  });

  document.getElementById('btnUnderstand').addEventListener('click', function (e) {
    e.stopPropagation();
    document.getElementById('section4').classList.remove('active');
    document.getElementById('section-1').classList.add('active');
  });

  document.getElementById('btnNotUnderstand2').addEventListener('click', function (e) {
    e.stopPropagation();
    window.location.hash = 'section4';
  });
  document.getElementById('btnUnderstand2').addEventListener('click', function (e) {
    e.stopPropagation();
    window.location.hash = 'section9';
  });

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  function openSectionFromHash() {
    const hash = window.location.hash.replace('#', '');
    if (hash) {
      const allSections = document.querySelectorAll(
        '#section-1,#section0 ,#section1, #section2, #section3, #section4, #section5, #section6, #section7, #section8, #section9'
      );
      allSections.forEach(sec => sec.classList.remove('active'));

      const targetSection = document.getElementById(hash);
      if (targetSection) {
        targetSection.classList.add('active');
      }
    }
  }


  openSectionFromHash();

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  window.addEventListener('hashchange', openSectionFromHash);
  document.getElementById('profileForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const name = document.getElementById('nameInput').value.trim();
    const age = parseInt(document.getElementById('ageInput').value);
    const gender = document.getElementById('genderSelect').value;
    const userId = localStorage.getItem('userID');

    if (!name || !age || !gender) {

      return;
    }

    try {
      const res = await fetch('/save-profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, age, gender, userID: userId })
      });

      const data = await res.json();
      if (data.success) {
        localStorage.setItem('profileId', data.profileId);

      } else {
        alert(data.message || 'เกิดข้อผิดพลาด');
      }
    } catch (err) {
      console.error(err);

    }
  });


  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  let currentAudio = null;
  let isPlaying = false;
  let typingTimeout;

  function playText(sectionId) {
    const textEl = document.getElementById('nicotineText' + sectionId);
    const audio = document.getElementById('voice' + sectionId);
    const nextBtn = document.getElementById('nextBtn' + (sectionId - 2));

    if (!textEl || !audio) return;

    if (isPlaying) {
      clearTimeout(typingTimeout);
      textEl.textContent = textEl.dataset.fullText;
      audio.pause();
      audio.currentTime = 0;
      isPlaying = false;
      if (nextBtn) {
        nextBtn.style.pointerEvents = 'auto';
        nextBtn.style.opacity = '1';
      }
      return;
    }


    if (!textEl.dataset.fullText) textEl.dataset.fullText = textEl.textContent;
    const fullText = textEl.dataset.fullText;


    if (currentAudio) {
      currentAudio.pause();
      currentAudio.currentTime = 0;
    }
    currentAudio = audio;


    if (nextBtn) {
      nextBtn.style.pointerEvents = 'none';
      nextBtn.style.opacity = '0.5';
    }

    textEl.textContent = '';
    audio.load();
    audio.play().catch(err => console.log('Play blocked:', err));
    isPlaying = true;


    let charIndex = 0;
    function typeNextChar() {
      textEl.textContent += fullText[charIndex];
      charIndex++;
      if (charIndex < fullText.length) {
        typingTimeout = setTimeout(typeNextChar, 72);
      } else {

        audio.onended = () => {
          isPlaying = false;
          if (nextBtn) {
            nextBtn.style.pointerEvents = 'auto';
            nextBtn.style.opacity = '1';
          }
        };
      }
    }
    typeNextChar();


    const sectionEl = document.getElementById('section' + sectionId);
    sectionEl.addEventListener('click', function () {
      if (isPlaying) {
        clearTimeout(typingTimeout);
        textEl.textContent = fullText;
        audio.pause();
        audio.currentTime = 0;
        isPlaying = false;
        if (nextBtn) {
          nextBtn.style.pointerEvents = 'auto';
          nextBtn.style.opacity = '1';
        }
      }
    }, { once: true });
  }


  document.getElementById('nextBtn3').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('section5').classList.remove('active');
    document.getElementById('section6').classList.add('active');
  });

  document.getElementById('nextBtn4').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('section6').classList.remove('active');
    document.getElementById('section7').classList.add('active');
  });

  document.getElementById('nextBtn5').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('section7').classList.remove('active');

    const music = document.getElementById("bgMusic");
    localStorage.setItem("musicTime", music.currentTime);
    window.location.href = "quiz";

  });


</script>

</html>