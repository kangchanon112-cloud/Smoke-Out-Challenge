<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <title>Part 4</title>
    <style>
        body {
            background-color: #fbdfc7;
            color: #333333;
            font-family: "Prompt", sans-serif;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        #section0,
        #section1,
        #section2,
        #section3,
        #section4,
        #section5,
        #section6,
        #section7,
        #section8,
        #section9,
        #section10,
        #section11,
        #section12 {
            display: none !important;
            width: 100%;
            height: 100%;
            padding: 0 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        #section0.active,
        #section1.active,
        #section2.active,
        #section3.active,
        #section4.active,
        #section5.active,
        #section6.active,
        #section7.active,
        #section8.active,
        #section9.active,
        #section10.active,
        #section11.active,
        #section12.active {
            display: flex !important;
        }


        .quote {
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.8;
            font-style: italic;
            color: #555555;
        }




        .arrow-text {
            display: inline-block;
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            color: #7c7c7c60;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s, transform 0.2s;
            border-radius: 0.5rem;
            user-select: none;
            cursor: pointer;
        }

        .arrow-text:hover {
            color: #555555a5;
            transform: scale(1.1);
        }

        .section {
            min-height: 100vh;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }


        #inputBox {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            background: #ffe9c4;
            padding: 15px 20px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.266);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #message {
            width: 250px;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
            background: #fef7e4c8;
        }

        #sendBtn {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: #ffa813bb;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #sendBtn:hover {
            background: #dd8a0c;
        }


        #stickers {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .sticker {
            font-size: 35px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .sticker:hover {
            transform: scale(1.2);
        }

        .floating-static {
            position: absolute;
            font-size: 1.5rem;
            color: #333;
            background: #e6dccf;
            border-radius: 25px;
            padding: 12px 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        }

        .center-expand {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.2);
            font-size: 2rem;
            opacity: 0;
            animation: expandCenter 0.6s ease-out forwards;
        }

        @keyframes expandCenter {
            0% {
                transform: translate(-50%, -50%) scale(0.2);
                opacity: 0;
            }

            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 1;
            }
        }

        #section1 {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }


        .ma {
            position: absolute;
            bottom: 8%;
            left: 0;
            right: 0;
        }


        .word {
            opacity: 0;
            display: inline-block;
            transform: translateY(15px);
            animation: fadeUp 0.5s forwards;
        }

        @keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ma5 {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }


        #section4 {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #scoreCard {
            border-radius: 20px;
            background-color: #f8d7da77;
            border: 1px solid #f5c2c277;
            padding: 30px 40px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
            max-width: 500px;
            width: 90%;
            transition: background-color 0.3s, border-color 0.3s;
        }

        #totalScore {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        #scoreLevel {
            font-size: 1.5rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
        }

        #scoreMessage {
            font-size: 1.1rem;
            color: #666;
            line-height: 1.6;
        }

        .boxed {
            border: 2px solid #6b4f3f;
            border-radius: 10px;
            padding: 15px;
            background-color: #fff6ec23;
            display: inline-block;
            margin: 5%;
        }


        .bg {
            background-image: url('/public/img/part4/1.png');
            background-size: clamp(30px, 16vw, 120px);
            background-repeat: no-repeat;
            background-position: right 0% top 95%;
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .bg2 {
            background-image: url('/public/img/part4/8.png'), url('/public/img/part4/3.png');
            background-size: clamp(100px, 30vw, 200px), clamp(400px, 60vw, 900px);
            background-repeat: no-repeat, no-repeat;
            background-position: right 48% top 3%, right 50% top 85%;
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .bg3 {
            background-image: url('/public/img/part4/5.png'), url('/public/img/part4/4.png'), url('/public/img/part4/2.png');
            background-size: 8rem, 8rem, clamp(27rem, 50vw, 50rem);
            background-repeat: no-repeat, no-repeat, no-repeat;
            background-position: right 0% top 0%, left 0% top 100%, right 50% top 50%;
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        #section4 {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        #scoreImage {

            width: clamp(35rem, 100vw, 50rem);
            height: auto;
            display: block;
            margin: 15px auto;
        }


        .character {
            position: relative;
            display: inline-block;
        }

        .speech-box {
            position: absolute;
            top: 34%;
            right: 32%;
            text-align: center;
            transform: translate(50%, -50%);
        }


        .speech-box img {
            width: clamp(6rem, 12vw, 11rem);
        }

        .speech-box span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(10px, 2vw, 20px);
            font-weight: bold;
            color: #000;
            white-space: nowrap;
        }


        #display-part3 .floating {
            position: absolute;
            font-size: 50px;
            animation: floatUp 3s linear forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-300px);
                opacity: 0;
            }
        }

        #inputBox-part3 {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            background: #ffe9c4;
            padding: 15px 20px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.266);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #message-part3 {
            width: 250px;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
            background: #fef7e4c8;
        }

        #sendBtn-part3 {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: #ffa813bb;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #sendBtn-part3:hover {
            background: #dd8a0c;
        }

        #stickers-part3 {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        #stickers-part3 .sticker {
            font-size: 35px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #stickers-part3 .sticker:hover {
            transform: scale(1.2);
        }


        video {
            width: 100%;
            max-width: 800px;
            max-height: 70vh;
            height: auto;
        }

        .option-btn {
            display: block;
            width: 250px;
            margin: 15px auto;
            padding: 12px;
            border: 2px solid black;
            border-radius: 8px;
            color: #000000;
            background: #fab67749;
            cursor: pointer;
            font-size: 18px;
            transition: 0.3s;
        }



        .high:hover {
            background: #28a745;
            border-color: #0f461c;
            color: #000000;
        }


        .medium:hover {
            background: #ffc107;
            border-color: #947006;
            color: #000000;
        }


        .low:hover {
            background: #dc3545;
            border-color: #7c1f28;
            color: #000000;
        }


        .stars {
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 60px;
            cursor: pointer;
        }

        .star {
            color: gray;
            transition: 0.3s;
        }

        .star.selected:nth-child(1) {
            color: #ffeb86;
        }

        .star.selected:nth-child(2) {
            color: #ffe066;
        }

        .star.selected:nth-child(3) {
            color: #ffd11a;
        }

        .star.selected:nth-child(4) {
            color: #ffbf00;
        }

        .star.selected:nth-child(5) {
            color: #ffaa00;
        }

        .feedback-box {
            margin-top: 30px;
        }

        .feedback-box textarea {
            width: 300px;
            height: 100px;
            border: 1px solid rgba(0, 0, 0, 0.5);
            background-color: rgba(255, 255, 255, 0.35);
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
            color: #000;
            resize: none;
            transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s;
        }

        .feedback-box textarea:focus {
            outline: none;
            border-color: rgba(0, 0, 0, 0.7);
            background-color: rgba(255, 255, 255, 0.45);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }


        #submitFeedback {
            margin-top: 10px;
            padding: 8px 20px;
            font-size: 16px;
            border: 1px solid rgba(255, 160, 50, 0.7);
            border-radius: 8px;
            background-color: rgba(255, 200, 120, 0.6);
            color: #000;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s, transform 0.2s;
        }

        #submitFeedback:hover {
            background-color: rgba(255, 180, 58, 0.884);
            border-color: rgba(255, 170, 50, 0.8);
            transform: translateY(-2px);
        }

        #submitFeedback:active {
            transform: translateY(0);
            background-color: rgba(255, 180, 80, 0.7);
        }

        #popupMessage {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            padding: 12px 25px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.4s, transform 0.4s, background-color 0.3s;
        }

        #popupMessage.show {
            display: block;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        #popupMessage.success {
            background-color: rgba(92, 236, 138, 0.9);
        }

        #popupMessage.error {
            background-color: rgba(236, 138, 92, 0.9);
        }
    </style>

</head>

<body>
    <div class="text-center" id="section0">
        <div id="display-part3"></div>
        <h2 class="mb-4">วันนี้รู้สึกอย่างไรบ้าง</h2>
        <div id="inputBox">
            <input type="text" id="message-part3" placeholder="พิมพ์ข้อความหรือ emoji...">
            <button id="sendBtn-part3">ส่ง</button>
        </div>

        <div id="stickers-part3">
            <span class="sticker" data-sticker="😀">😀</span>
            <span class="sticker" data-sticker="🔥">🔥</span>
            <span class="sticker" data-sticker="🎉">🎉</span>
        </div>
        <div class="ma">
            <a href="#" id="nextBtn0" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>


    <!-- ส่วนที่ 1 -->
    <div class="text-center bg" id="section1">
        <div id="display"></div>
        <h2 class="mb-4 boxed">เด็ก ๆ มีวิธีปฏิเสธอย่างไร เมื่อถูกชักชวนให้สูบบุหรี่</h2>
        <div class="ma5">
            <div id="inputBox">
                <input type="text" id="message" placeholder="พิมพ์ข้อความ...">
                <button id="sendBtn">ส่ง</button>
            </div>
        </div>
        <div class="ma">
            <a href="#" id="nextBtn1" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>



    <!-- ส่วนที่ 2 -->
    <div class=" text-center bg2" id="section2">
        <h2 id="quote2" class="fw-bold mb-5 quote fs-3" style="color: #222222;">
            เยี่ยมมากเลยมาถึงครึ่งทางแล้วคุณมีความพยายามและตั้งใจจริงอย่าลืมว่าทุกก้าวเล็กๆ
            ที่เดินมาถึงตรงนี้คือความสําเร็จที่นับได้แล้ว สู้ต่ออีกหน่อยอีกครึ่งทางก็จะถึงเป้าหมายแล้วนะ
        </h2>
        <div class="ma">
            <a href="#" id="nextBtn9" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>


    <!-- ส่วนที่ 3 -->
    <div class=" text-center py-5 bg3" id="section3">
        <div class="ma">
            <a href="#" id="nextBtn2" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>

    <!-- 
    <div class="container text-center py-5" id="section4">
        <div id="scoreCard">
            <h2 class="fw-bold my-3 quote" style="color: #222222;">คะแนนสะสมของคุณ</h2>
            <img id="scoreImage" src="" alt="ระดับคะแนน" style="max-width:150px; margin:15px auto; display:block;">
            <h2 id="totalScore" class=" fw-bold">กำลังโหลด...</h2>
            <h3 id="scoreLevel" class="mt-3 fw-bold"></h3>
            <p id="scoreMessage" class= "mt-2 fs-5"></p>
        </div>
    </div> -->
    <!-- ส่วนที่ 4 -->
    <div class="text-center" id="section4">

        <div class="character">
            <img id="scoreImage" src="" alt="ระดับคะแนน">
            <div class="speech-box">
                <img src="/public/img/part4/10.png" alt="">
                <span id="scoreBubble">0 คะแนน</span>
            </div>
        </div>

    </div>


    <!-- ส่วนที่ 5 -->
    <div class="container text-center" id="section5">
        <h2 class="fw-bold  quote" style="color: #222222;">
        </h2>
        <video id="video14" src="/public/img/part4/p4.mp4" class="img-fluid rounded-3 shadow mb-5"
            style="max-width: 800px; width: 100%; height: auto;" controls>
        </video>
        <div class="ma">
            <a href="#" id="nextBtn5" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>

    <!-- ส่วนที่ 6 -->
    <div class="container text-center" id="section6">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            น้อง ๆ มีความมั่นใจในการปฏิเสธการสูบบุหรี่ไฟฟ้าระดับใด
        </h2>
        <button class="option-btn high">มั่นใจมาก</button>
        <button class="option-btn medium">มั่นใจปานกลาง</button>
        <button class="option-btn low">ไม่มีความมั่นใจ</button>
    </div>

    <!-- ส่วนที่ 7 -->
    <div class="container text-center" id="section7">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            การปฏิเสธบุหรี่ได้
            คือความกล้าหาญที่แท้จริง ไม่ใช่
            ทุกคนจะทําได้นะ
        </h2>
    </div>

    <!-- ส่วนที่ 8 -->
    <div class="container text-center" id="section8">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            ฉันเชื่อว่าเธอทําได้และเธอก็ <br>
            มีศักยภาพมากกว่าที่เธอคิด
        </h2>
    </div>

    <!-- ส่วนที่ 9 -->
    <div class="container text-center" id="section9">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            ไม่ว่าคุณจะต้องเผชิญกับอะไรก็ตาม
            ขอจงอย่าสงสัยในคุณค่าของตัวเอง
            อย่าปล่อยให้ความกลัวมาบั่นทอนความฝันของคุณ
        </h2>
    </div>

    <!-- ส่วนที่ 10 -->
    <div class="container text-center" id="section10">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            ชีวิตที่ดีสร้างได้ด้วยตัวเราเอง
            อย่าทําร้ายตัวเองด้วยควันบุหรี่ไฟฟ้านะ
        </h2>
    </div>

    <!-- ส่วนที่ 11 -->
    <div class="container text-center" id="section11">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            รักตัวเอง อย่าทําร้ายตัวเองด้วยควันพิษ
        </h2>
    </div>

    <!-- ส่วนที่ 12 -->
    <div class="container text-center" id="section12">
        <div class="stars" id="stars">
            <span class="star" data-value="1">★</span>
            <span class="star" data-value="2">★</span>
            <span class="star" data-value="3">★</span>
            <span class="star" data-value="4">★</span>
            <span class="star" data-value="5">★</span>
        </div>

        <div class="feedback-box mt-3">
            <textarea id="feedback" placeholder="ข้อเสนอแนะ..."></textarea>
            <br>
            <button id="submitFeedback">ส่งข้อเสนอแนะ</button>
        </div>
        <div id="popupMessage"></div>
    </div>

    <audio id="bgMusic" src="/public/img/part1/m2.mp3" loop></audio>
    <script>
        const music = document.getElementById("bgMusic");
        const savedTime = localStorage.getItem("musicTime");
        if (savedTime) {
            music.currentTime = parseFloat(savedTime);
        }

        function startMusicOnce() {
            if (music.paused) {
                music.volume = 0.2;
                music.play().catch(err => console.log("Autoplay blocked:", err));
            }

            setInterval(() => {
                if (!music.paused) {
                    localStorage.setItem("musicTime", music.currentTime);
                }
            }, 1000);

            document.removeEventListener("click", startMusicOnce, true);
            document.removeEventListener("touchstart", startMusicOnce, true);
            document.removeEventListener("keydown", startMusicOnce, true);
        }

        document.addEventListener("click", startMusicOnce, { once: true, capture: true });
        document.addEventListener("touchstart", startMusicOnce, { once: true, capture: true });
        document.addEventListener("keydown", startMusicOnce, { once: true, capture: true });

        const videos = document.querySelectorAll("video");
        videos.forEach(video => {
            video.addEventListener("play", () => {
                music.volume = 0.05;
            });
            video.addEventListener("pause", () => {
                music.volume = 0.2;
            });
            video.addEventListener("ended", () => {
                music.volume = 0.2;
            });
        });

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setTimeout(() => {
                    document.getElementById('section6').classList.remove('active');
                    document.getElementById('section7').classList.add('active');
                }, 500);
            });
        });

        document.getElementById('section0').classList.add('active');

        const nextBtn1 = document.getElementById('nextBtn1');
        const nextBtn0 = document.getElementById('nextBtn0');
        function clearFloatingMessages() {
            const floatingMessages = document.querySelectorAll('body > div');
            floatingMessages.forEach(msg => {
                if (msg.style && (msg.style.position === 'absolute' || msg.classList.contains('center-expand'))) {
                    msg.remove();
                }
            });
        }
        nextBtn1.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('section1').classList.remove('active');
            document.getElementById('section2').classList.add('active');
            clearFloatingMessages();
        });
        nextBtn0.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('section0').classList.remove('active');
            document.getElementById('section1').classList.add('active');
            clearFloatingMessages();
        });

        document.getElementById('nextBtn2').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('section3').classList.remove('active');
            localStorage.setItem("musicTime", music.currentTime);
            window.location.href = "quiz4";
        });

        document.getElementById('nextBtn5').addEventListener('click', (e) => {
            e.preventDefault();
            const video = document.getElementById("video14");
            video.pause();
            video.currentTime = 0;
            document.getElementById('section5').classList.remove('active');
            document.getElementById('section6').classList.add('active');
        });

        document.body.addEventListener('click', function (e) {
            const activeSectionIds = [
                'section0', 'section1', 'section2', 'section3', 'section4', 'section5', 'section6', 'section7', 'section8', 'section9', 'section10', 'section11', 'section12'
            ];

            let currentIndex = activeSectionIds.findIndex(id => document.getElementById(id).classList.contains('active'));
            if (currentIndex === -1) return;

            const currentSectionId = activeSectionIds[currentIndex];
            if (currentSectionId === 'section0' || currentSectionId === 'section1' || currentSectionId === 'section2' || currentSectionId === 'section3' || currentSectionId === 'section5' || currentSectionId === 'section6' || currentSectionId === 'section12') {
                return;
            }
            document.getElementById(currentSectionId).classList.remove('active');

            if (currentIndex + 1 < activeSectionIds.length) {
                document.getElementById(activeSectionIds[currentIndex + 1]).classList.add('active');
            }
        });

        let typing = false;
        let typingTimer = null;

        function typeEffect(elementId, speed = 100) {
            const el = document.getElementById(elementId);
            const fullText = el.dataset.fulltext || el.innerText.trim();
            el.dataset.fulltext = fullText;
            el.innerText = "";

            let i = 0;
            typing = true;

            typingTimer = setInterval(() => {
                el.innerText += fullText[i];
                i++;
                if (i >= fullText.length) {
                    clearInterval(typingTimer);
                    typing = false;
                }
            }, speed);
        }

        const skipBtn = document.getElementById("nextBtn9");
        skipBtn.addEventListener("click", (e) => {
            e.preventDefault();
            const el = document.getElementById("quote2");
            const fullText = el.dataset.fulltext;

            if (typing) {
                clearInterval(typingTimer);
                el.innerText = fullText;
                typing = false;
            } else {
                document.getElementById("section2").classList.remove("active");
                document.getElementById("section3").classList.add("active");
            }
        });

        document.getElementById("nextBtn1").addEventListener("click", (e) => {
            e.preventDefault();
            document.getElementById("section1").classList.remove("active");
            document.getElementById("section2").classList.add("active");

            setTimeout(() => {
                typeEffect("quote2", 50);
            }, 200);
        });

        function openSectionFromHash() {
            const hash = window.location.hash.replace('#', '');
            if (hash) {
                const allSections = document.querySelectorAll('[id^="section"]');
                allSections.forEach(sec => sec.classList.remove('active'));

                const targetSection = document.getElementById(hash);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            }
        }

        openSectionFromHash();

        const socket = io();

        const messageInput = document.getElementById('message');
        const sendBtn = document.getElementById('sendBtn');
        const section1Display = document.getElementById('display');
        const section1 = document.getElementById('section1');

        function showFloatingMessage(msg) {
            const el = document.createElement('div');
            el.textContent = msg;
            el.className = 'floating';

            const width = section1.offsetWidth || window.innerWidth;
            const height = section1.offsetHeight || window.innerHeight;

            const randomX = Math.random() * (width - 250);
            const randomY = Math.random() * (height - 50);

            el.style.position = 'absolute';
            el.style.left = randomX + 'px';
            el.style.top = randomY + 'px';
            const lightColors = ['#fff3e0', '#e0f7fa', '#f3e5f5', '#e8f5e9', '#fffde7'];
            el.style.background = lightColors[Math.floor(Math.random() * lightColors.length)];
            el.style.color = '#555';
            el.style.border = '1px solid #e0d8c3';
            el.style.fontSize = '1.5rem';
            el.style.fontWeight = '600';
            el.style.padding = '12px 20px';
            el.style.borderRadius = '25px';
            el.style.boxShadow = '0 8px 20px rgba(0,0,0,0.25)';
            el.style.transform = 'scale(0.2) rotate(-15deg)';
            el.style.opacity = '0';
            el.style.textShadow = '1px 2px 6px rgba(0,0,0,0.3)';
            el.style.transition = 'transform 0.5s cubic-bezier(0.34,1.56,0.64,1), opacity 0.4s ease-out';

            section1.appendChild(el);

            requestAnimationFrame(() => {
                el.style.transform = 'scale(1) rotate(0deg)';
                el.style.opacity = '1';
            });
        }

        socket.on('receiveSticker-sec1', (msg) => {
            showFloatingMessage(msg);
        });

        function handleSend() {
            const text = messageInput.value.trim();
            if (!text) return;

            socket.emit('sendSticker-sec1', text);

            const username = localStorage.getItem("username") || "guest";
            fetch("/save-message", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username,
                    question: "เด็ก ๆ มีวิธีปฏิเสธอย่างไร เมื่อถูกชักชวนให้สูบบุหรี่",
                    message: text,
                    timestamp: new Date()
                })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        console.log("บันทึกเรียบร้อย");
                    } else {
                        console.error("บันทึกไม่สำเร็จ");
                    }
                })
                .catch(err => console.error(err));

            messageInput.value = '';
        }

        sendBtn.addEventListener('click', handleSend);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSend();
        });

        const part3Socket = io();
        const part3Display = document.getElementById('display-part3');
        const part3MessageInput = document.getElementById('message-part3');
        const part3SendBtn = document.getElementById('sendBtn-part3');
        const part3Stickers = document.querySelectorAll('#stickers-part3 .sticker');

        function sendStickerPart3(sticker) {
            part3Socket.emit('sendSticker-part3', sticker);
        }
        function sendMessagePart3() {
            const text = part3MessageInput.value.trim();
            if (!text) return;
            part3Socket.emit('sendSticker-part3', text);
            part3MessageInput.value = '';
        }
        part3SendBtn.addEventListener('click', sendMessagePart3);
        part3MessageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') sendMessagePart3();
        });

        part3Stickers.forEach(sticker => {
            sticker.addEventListener('click', () => {
                sendStickerPart3(sticker.textContent);
            });
        });

        part3Socket.on('receiveSticker-part3', (sticker) => {
            const s = document.createElement('div');
            s.textContent = sticker;
            s.className = 'floating';
            s.style.left = Math.random() * (window.innerWidth - 50) + 'px';
            s.style.top = window.innerHeight + 'px';
            part3Display.appendChild(s);

            setTimeout(() => {
                if (s && s.parentNode) {
                    s.remove();
                }
            }, 3000);
        });

        const totalScoreEl = document.getElementById("totalScore");
        const username = localStorage.getItem("username");
        const scoreImage = document.getElementById("scoreImage");
        const scoreBubbleEl = document.getElementById("scoreBubble");

        if (scoreBubbleEl && totalScoreEl) {
            scoreBubbleEl.textContent = totalScoreEl.textContent + " คะแนน";
        }

        if (!username) {
            alert('login')
        } else {
            fetch(`/totalScore/${username}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const score = data.totalScore;
                        if (totalScoreEl) totalScoreEl.textContent = score;
                        if (scoreBubbleEl) scoreBubbleEl.textContent = score + " คะแนน";
                        if (score < 12) {
                            scoreImage.src = "/public/img/part4/11.png";
                        } else if (score < 14) {
                            scoreImage.src = "/public/img/part4/12.png";
                        } else if (score < 16) {
                            scoreImage.src = "/public/img/part4/13.png";
                        } else {
                            scoreImage.src = "/public/img/part4/14.png";
                        }
                    }
                })
                .catch(err => {
                    console.error(err);
                });
        }

        function showPopup(message, type = "success", duration = 2000) {
            const popup = document.getElementById("popupMessage");
            popup.textContent = message;

            popup.classList.remove("success", "error");
            popup.classList.add(type);

            setTimeout(() => {
                popup.classList.add("show");
            }, 100);

            setTimeout(() => {
                popup.classList.remove("show");
            }, duration + 100);
        }

        let rating = 0;
        const stars = document.querySelectorAll("#stars .star");
        const feedbackInput = document.getElementById("feedback");

        stars.forEach(star => {
            star.addEventListener("click", () => {
                rating = star.dataset.value;
                stars.forEach(s => s.classList.remove("selected"));
                for (let i = 0; i < rating; i++) {
                    stars[i].classList.add("selected");
                }
            });
        });

        document.getElementById("submitFeedback").addEventListener("click", () => {
            const feedback = document.getElementById("feedback").value;

            if (rating === 0) {
                showPopup("กรุณาเลือกคะแนนก่อนส่ง", "error");
                return;
            }

            fetch("/submit-feedback", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, rating, feedback })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) showPopup(data.message, "success");
                    else showPopup(data.message, "error");

                    document.getElementById("feedback").value = "";
                    stars.forEach(s => s.classList.remove("selected"));
                    rating = 0;
                })
                .catch(err => showPopup("เกิดข้อผิดพลาด", "error"));
        });
    </script>


</body>

</html>