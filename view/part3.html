<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <title>Part 3</title>
    <style>
        body {
            background-color: #fbdfc7;
            color: #333333;
            font-family: "Prompt", sans-serif;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        #section1,
        #section2,
        #section3,
        #section4,
        #section5,
        #section6,
        #section7,
        #section8,
        #section9,
        #section10,
        #section11,
        #section12,
        #section13,
        #section14 {
            display: none !important;
            width: 100%;
            height: 100%;
            padding: 0 50px;
            /* กันชิดขอบ */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* กึ่งกลางแนวตั้ง */
            align-items: center;
            /* กึ่งกลางแนวนอน */
            text-align: center;
        }

        /* แสดง section ที่ active */
        #section1.active,
        #section2.active,
        #section3.active,
        #section4.active,
        #section5.active,
        #section6.active,
        #section7.active,
        #section8.active,
        #section9.active,
        #section10.active,
        #section11.active,
        #section12.active,
        #section13.active,
        #section14.active {
            display: flex !important;
        }


        .quote {
            max-width: 700px;
            /* จำกัดความกว้าง */
            margin: 0 auto;
            /* กึ่งกลางแนวนอน */
            line-height: 1.8;
            font-style: italic;
            color: #555555;
        }




        .arrow-text {
            display: inline-block;
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            color: #7c7c7c60;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s, transform 0.2s;
            border-radius: 0.5rem;
            user-select: none;
            cursor: pointer;
        }

        .arrow-text:hover {
            color: #555555a5;
            transform: scale(1.1);
        }

        .section {
            min-height: 100vh;
            /* อย่างน้อยเต็มจอ */
            width: 100%;
            padding: 20px;
            box-sizing: border-box;

            display: flex;
            flex-direction: column;
            justify-content: center;
            /* กึ่งกลางแนวตั้ง */
            align-items: center;
            /* กึ่งกลางแนวนอน */
            text-align: center;
        }



        /* กล่องข้อความมินิมอล */
        #inputBox {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            background: #ffe9c4;
            padding: 15px 20px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.266);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #message {
            width: 250px;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
            background: #fef7e4c8;
        }

        #sendBtn {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: #ffa813bb;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #sendBtn:hover {
            background: #dd8a0c;
        }


        #stickers {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .sticker {
            font-size: 35px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .sticker:hover {
            transform: scale(1.2);
        }

        .floating {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 3s ease-out forwards;
        }

        .center-expand {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.2);
            font-size: 2rem;
            opacity: 0;
            animation: expandCenter 0.6s ease-out forwards;
        }

        @keyframes expandCenter {
            0% {
                transform: translate(-50%, -50%) scale(0.2);
                opacity: 0;
            }

            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 1;
            }
        }

        #section1 {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            /* ชิดบน */
            align-items: center;
            height: 100vh;
            padding: 60px;

            box-sizing: border-box;
            position: relative;
        }




        .ma {
            position: absolute;
            bottom: 50px;
            left: 0;
            right: 0;
        }

        .ma5 {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .bg {
            background-image: url('/public/img/stop2.png'), url('/public/img/stop1.png'), url('/public/img/stop3.png');
            background-size: 8rem, 8rem, 8rem;
            background-repeat: no-repeat, no-repeat, no-repeat;
            background-position: right 0% top 100%, left 0% top 100%, right 0% top 0%;
            /* เว้นเป็น % */
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .bg2 {
            background-image: url('/public/img/part3/2.PNG');
            background-size: 20rem;
            background-repeat: no-repeat;
            background-position: right 50% top 50%;
            /* เว้นเป็น % */
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .bg3 {
            background-image: url('/public/img/part3/3.PNG');
            background-size: clamp(400px, 50vw, 800px);
            background-repeat: no-repeat;
            background-position: right 50% top 50%;
            /* เว้นเป็น % */
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .bg4 {
            background-image: url('/public/img/part3/5.PNG'), url('/public/img/part3/4.PNG');
            background-size: clamp(450px, 50vw, 800px), clamp(100px, 25vw, 280px);
            background-repeat: no-repeat, no-repeat;
            background-position: right 50% top 50%, right 1% top 100%;
            ;
            /* เว้นเป็น % */
            width: 95vw;
            height: 95vh;
            margin: 0;
            padding: 0;
        }

        .boxed {
            border: 2px solid #6b4f3f;
            /* เส้นกรอบ */
            border-radius: 10px;
            /* มุมโค้ง */
            padding: 15px;
            /* ระยะห่างข้อความกับกรอบ */
            background-color: #fff6ec23;
            /* พื้นหลังอ่อนๆ */
            display: inline-block;
            /* ให้กรอบพอดีกับข้อความ */
        }
    </style>
</head>

<body>

    <!-- ส่วนที่ 1 -->
    <div class="text-center" id="section1">
        <div id="display"></div>

        <h2 class="mb-4 ">เด็ก ๆ มีวิธีปฏิเสธอย่างไรบ้าง เมื่อถูกชักชวนให้สูบบุหรี่</h2>


        <div class="ma5">

            <div id="inputBox">
                <input type="text" id="message" placeholder="พิมพ์ข้อความ...">
                <button id="sendBtn">ส่ง</button>
            </div>
        </div>
        <div class="ma">
            <a href="#" id="nextBtn1" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>



    <!-- ส่วนที่ 2 -->
    <div class="container text-center py-4" id="section2">
        <h2 class="fw-bold my-5 quote fs-3" style="color: #222222;">
            หากคุณตกอยู่ในสถานการณ์เหล่านี้
            คุณจะเลือกใช้เทคนิคการปฏิเสธ
            ให้เหมาะสมกับสถานการณ์อย่างไร
        </h2>
        <div class="ma">
            <a href="#" id="nextBtn2" class="arrow-text">แตะเพื่อไปต่อ</a>
        </div>
    </div>


    <!-- ส่วนที่ 3 -->
    <div class=" text-center bg2" id="section3">
        <h2 class="fw-bold my-5 quote" style="color: #15881b;">
            เท่ได้ไม่พึ่งควัน
        </h2>
    </div>



    <!-- ส่วนที่ 4 -->
    <div class="bg3 text-center" id="section4">
        <h3 class="fw-bold my-5 quote" style="color: #15881b;">
            ความเท่ที่แท้จริง <br>
            คือการดูแลตัวเองให้ดีที่สุด <br>
            ไม่ใช่การถือบุหรี่

        </h3>
    </div>

    <!-- ส่วนที่ 5 -->
    <div class="bg4 text-center" id="section5">
        <h2 class="fw-bold my-5 quote" style="color: #222222;">
            คุณกล้าพอไหม <br>ที่จะมาร่วมกับเราอีกครั้ง
        </h2>
    </div>

    <audio id="bgMusic" src="/public/img/part1/m2.mp3" loop></audio>
    <script>

      const music = document.getElementById("bgMusic");

// โหลดเวลาที่เคยบันทึกไว้
const savedTime = localStorage.getItem("musicTime");
if (savedTime) {
    music.currentTime = parseFloat(savedTime); // set เวลาเดิม
}

// เล่นเพลงเมื่อ user แตะ
document.body.addEventListener("click", () => {
    if (music.paused) {
        music.volume = 0.2;
        music.play().catch(err => console.log("Autoplay blocked:", err));
    }
});

// บันทึกเวลาล่าสุดทุก 1 วินาที
setInterval(() => {
    if (!music.paused) {
        localStorage.setItem("musicTime", music.currentTime);
    }
}, 1000);



        const videos = document.querySelectorAll('video'); 

        videos.forEach(video => {
            video.addEventListener('play', () => {
                music.volume = 0.05; // ลดเสียงเพลงตอนวิดีโอเล่น
            });

            video.addEventListener('pause', () => {
                music.volume = 0.2; // กลับมาเสียงปกติ
            });

            video.addEventListener('ended', () => {
                music.volume = 0.2; // กลับมาเสียงปกติ
            });
        });

        document.getElementById('section1').classList.add('active');

        const nextBtn1 = document.getElementById('nextBtn1');
        function clearFloatingMessages() {
            const floatingMessages = document.querySelectorAll('body > div');
            floatingMessages.forEach(msg => {
                // เช็คว่ามี class หรือ style ของ floating message
                if (msg.style && (msg.style.position === 'absolute' || msg.classList.contains('center-expand'))) {
                    msg.remove();
                }
            });
        }

        // เมื่อกด nextBtn1
        nextBtn1.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('section1').classList.remove('active');
            document.getElementById('section2').classList.add('active');
            clearFloatingMessages(); // ล้างข้อความลอย
        });

        document.getElementById('nextBtn2').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('section3').classList.remove('active');
             localStorage.setItem("musicTime", music.currentTime);
            window.location.href = "quiz3";
        });



        document.body.addEventListener('click', function (e) {
            const activeSectionIds = [
                'section1', 'section2', 'section3', 'section4', 'section5',

            ];

            let currentIndex = activeSectionIds.findIndex(id => document.getElementById(id).classList.contains('active'));
            if (currentIndex === -1) return;

            // ห้ามข้าม section3 และ section12
            const currentSectionId = activeSectionIds[currentIndex];
            if (currentSectionId === 'section1' || currentSectionId === 'section5' || currentSectionId === 'section2') {
                return;
            }

            // ปิด section ปัจจุบัน
            document.getElementById(currentSectionId).classList.remove('active');

            // เปิด section ถัดไป (ถ้ามี)
            if (currentIndex + 1 < activeSectionIds.length) {
                document.getElementById(activeSectionIds[currentIndex + 1]).classList.add('active');
            }
        });






        function openSectionFromHash() {
            const hash = window.location.hash.replace('#', '');
            if (hash) {
                const allSections = document.querySelectorAll(
                    ' #section1, #section4, #section5'
                );
                allSections.forEach(sec => sec.classList.remove('active'));

                const targetSection = document.getElementById(hash);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            }
        }



        openSectionFromHash();


        const socket = io();

        const messageInput = document.getElementById('message');
        const sendBtn = document.getElementById('sendBtn');

        // ฟังก์ชันโชว์ข้อความลอย
        function showFloatingMessage(msg) {
            const el = document.createElement('div');
            el.textContent = msg;
            el.style.position = 'absolute';


            const randomX = Math.random() * (window.innerWidth - 250);
            const randomY = Math.random() * (window.innerHeight - 50);

            el.style.left = randomX + 'px';
            el.style.top = randomY + 'px';

            el.style.color = '#333'; // ตัวอักษรสีเข้ม
            el.style.background = '#e6dccf'; // ครีมอ่อน
            el.style.border = '1px solid #e0d8c3'; // ขอบอ่อน
            el.style.fontSize = '1.5rem';
            el.style.fontWeight = '600';
            el.style.padding = '12px 20px';
            el.style.borderRadius = '25px';
            el.style.boxShadow = '0 8px 20px rgba(0,0,0,0.25)';
            el.style.transform = 'scale(0.2) rotate(-15deg)';
            el.style.opacity = '0';
            el.style.textShadow = '1px 2px 6px rgba(0,0,0,0.3)';
            el.style.transition = 'transform 0.5s cubic-bezier(0.34,1.56,0.64,1), opacity 0.4s ease-out';

            document.body.appendChild(el);

            requestAnimationFrame(() => {
                el.style.transform = 'scale(1) rotate(0deg)';
                el.style.opacity = '1';
            });
        }

        // รับข้อความจาก server ทุกคน
        socket.on('receiveSticker', (msg) => {
            showFloatingMessage(msg);
        });

        // ส่งข้อความ
        function handleSend() {
            const text = messageInput.value.trim();
            if (!text) return;
            socket.emit('sendSticker', text); // ส่งไป server
            messageInput.value = '';
        }

        sendBtn.addEventListener('click', handleSend);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSend();
        });




    </script>

</body>


</html>
